CTCR	EQU		0FFFF0000
CTLR	EQU 	0FFFF0004
CTBS	EQU 	0FFFF0008
CTEND	EQU 	0FFFF000C

DMAIZV		EQU		0FFFF1000
DMAODR		EQU 	0FFFF1004
DMABRPOD	EQU 	0FFFF1008
DMACR		  EQU 	0FFFF100C
DMASTART	EQU 	0FFFF1010
DMAIACK		EQU 	0FFFF1014

BVJ	EQU 0FFFFFFFC

			ORG 0
      
			MOVE 10000, SP
			JP MAIN

			ORG 0C

			JP PREKID

MAIN	MOVE BVJ, R0
			STORE R0, (DMAIZV)
		
			MOVE %D 9, R1
			STORE R1, (DMABRPOD)

			MOVE %B 0111, R2
			STORE R2, (DMACR)

			MOVE 1000, R3
			STORE R3, (DMAODR)

			MOVE %B 001, R4
			STORE R4, (CTCR)

			MOVE %D 1000, R5
			STORE R5, (CTLR)

BLOKOVI DW 0
ADDRESS DW 1000

FOR   LOAD R0, (BLOKOVI)

			CMP R0, 5
			JP_EQ END

			LOAD R0, (CTBS)
			
			CMP R0, 0
			JP_EQ FOR

			STORE R0, (CTBS)
			MOVE 1, R0

			STORE R0, (CTEND)
			STORE R0, (DMASTART)

			JP FOR	

END   MOVE 0, R0
			STORE R0, (CTCR)
			STORE R0, (DMACR)

			HALT

PREKID PUSH R0
			 PUSH R1

			 MOVE SR, R0
			 PUSH R0

			 STORE R0, (DMAIACK)

			 LOAD R0, (ADDRESS)
			 ADD R0, %D 36, R0

	  	 MOVE -1, R1
	  	 STORE R1, (R0)

	  	 ADD R0, 4, R0
	  	 STORE R0, (DMAODR)
	  	 STORE R0, (ADDRESS)		

	  	 MOVE 9, R0
	  	 STORE R0, (DMABRPOD)
	  	 
	  	 LOAD R0, (BLOKOVI)
	  	 ADD R0, 1, R0
	  	 STORE R0, (BLOKOVI)
	  	 
	  	 POP R0
	  	 MOVE R0, SR
	  	 POP R1
	  	 POP R0

	  	 RETN

